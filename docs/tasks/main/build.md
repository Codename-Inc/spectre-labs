---
tasks: /Users/joe/Dev/spectre-labs/docs/tasks/main/specs/tasks.md
context:
  - /Users/joe/Dev/spectre-labs/docs/tasks/ship-loop/concepts/scope.md
  - /Users/joe/Dev/spectre-labs/docs/tasks/main/specs/plan.md
max_iterations: 15
validate: true
---

# Build Manifest

Generated by `spectre-build --plan` planning pipeline.

## Inputs
- **Scope**: `/Users/joe/Dev/spectre-labs/docs/tasks/ship-loop/concepts/scope.md`
- **Plan**: /Users/joe/Dev/spectre-labs/docs/tasks/main/specs/plan.md
- **Tasks**: /Users/joe/Dev/spectre-labs/docs/tasks/main/specs/tasks.md

## Requirements Coverage

| Requirement | Description | Task(s) | Status |
|-------------|-------------|---------|--------|
| REQ-001 | `--ship` flag as `store_true` argument in `parse_args()` | 1.1 | Covered |
| REQ-002 | `--ship` routing in `main()` after `--plan` but before `--validate` | 1.1 | Covered |
| REQ-003 | `run_ship_pipeline()` function modeled on `run_plan_pipeline()` | 1.2 | Covered |
| REQ-004 | Parent branch detection with fail-fast error on failure | 1.2 | Covered |
| REQ-005 | Working set scope computation (`{parent_branch}..HEAD`) | 1.2 | Covered |
| REQ-006 | Interactive mode with `"ship"` option in `prompt_for_mode()` | 1.3 | Covered |
| REQ-007 | `create_ship_pipeline()` factory returning 3-stage PipelineConfig | 2.1 | Covered |
| REQ-008 | Clean stage: `JsonCompletion`, `CLEAN_TASK_COMPLETE`/`CLEAN_COMPLETE` signals, max 10 iterations | 2.1 | Covered |
| REQ-009 | Test stage: `JsonCompletion`, `TEST_TASK_COMPLETE`/`TEST_COMPLETE` signals, max 10 iterations | 2.1 | Covered |
| REQ-010 | Rebase stage: `JsonCompletion`, `SHIP_COMPLETE` signal, max 3 iterations | 2.1 | Covered |
| REQ-011 | `ship_before_stage()` and `ship_after_stage()` hooks | 2.2 | Covered |
| REQ-012 | HEAD snapshot before clean and test stages, diff capture after | 2.2 | Covered |
| REQ-013 | `clean_summary` and `test_summary` injected into context by after-hooks | 2.2 | Covered |
| REQ-014 | Clean prompt template with 7-task checklist, `{parent_branch}` and `{working_set_scope}` variables | 3.1 | Covered |
| REQ-015 | Test prompt template with 4-task checklist, `{working_set_scope}` variable | 3.2 | Covered |
| REQ-016 | Rebase prompt template (single context window), `{parent_branch}`, `{clean_summary}`, `{test_summary}` variables | 3.3 | Covered |
| REQ-017 | PR creation via `gh pr create` with template detection, or local merge with stash approval | 3.3 | Covered |
| REQ-018 | Session persistence: `ship` and `ship_context` fields in `save_session()` with backward compat | 4.1 | Covered |
| REQ-019 | Resume routing: `elif session.get("ship"):` in `run_resume()` | 4.1 | Covered |
| REQ-020 | `format_session_summary()` shows "Mode: Ship" and parent branch | 4.1 | Covered |
| REQ-021 | `ship: bool = False` field in `BuildManifest`, parsed from frontmatter | 4.2 | Covered |
| REQ-022 | Manifest routing: `manifest.ship` routes to `run_ship_pipeline()` in `run_manifest()` | 4.2 | Covered |
| REQ-023 | `ship_loops: int = 0` field in `BuildStats` | 4.3 | Covered |
| REQ-024 | `create_ship_event_handler()` factory for stats | 4.3 | Covered |
| REQ-025 | `print_summary()` displays ship loop count when > 0 | 4.3 | Covered |
| REQ-026 | `notify_ship_complete()` function with audio | 4.4 | Covered |
| REQ-027 | Notification called from all ship entry points (main, resume, manifest) | 4.4 | Covered |
| REQ-028 | Same denied tools as build loop for all 3 ship stages | 2.1 | Covered |
| REQ-029 | Context files optional for ship (not required like `--plan`) | 1.1, 1.3 | Covered |
| REQ-030 | No changes to PipelineExecutor, stage.py, completion.py, stream.py, or agent.py | all | Covered |

## Command
```bash
spectre-build /Users/joe/Dev/spectre-labs/docs/tasks/main/build.md
```
